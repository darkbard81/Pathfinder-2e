{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Session_Tracking",
  "type": "object",
  "properties": {
    "time_track": {
      "type": "object",
      "properties": {
        "timestamp": {
          "type": "string",
          "description": "In-game current time. Example: Day 7 - 07:30"
        },
        "fatigue_check_elapsed_minutes": {
          "type": "integer",
          "description": "Minutes elapsed since last sleep/rest."
        },
        "hunger_check_elapsed_minutes": {
          "type": "integer",
          "description": "Minutes elapsed since last meal."
        },
        "emotion_check_elapsed_minutes": {
          "type": "integer",
          "description": "Minutes elapsed since the last significant emotional event."
        }
      },
      "required": [
        "timestamp",
        "fatigue_check_elapsed_minutes",
        "hunger_check_elapsed_minutes",
        "emotion_check_elapsed_minutes"
      ]
    },
    "shared_inventory": {
      "type": "object",
      "properties": {
        "items": {
          "type": "array",
          "description": "List of shared items.",
          "items": {
            "type": "string"
          }
        },
        "gp": {
          "type": "integer",
          "description": "Amount of shared gold pieces (gp)."
        }
      },
      "required": [
        "items",
        "gp"
      ]
    },
    "npc_goals": {
      "type": "array",
      "description": "A list of NPCs and their encoded final goals.",
      "items": {
        "type": "object",
        "properties": {
          "npc_name": {
            "type": "string",
            "description": "The name of the NPC."
          },
          "personality": {
            "type": "string",
            "description": "The unique set of characteristics and traits..."
          },
          "relational_disposition": {
            "type": "string",
            "description": "Relationship tendencies..."
          },
          "encoding_type": {
            "type": "string",
            "description": "The encoding type used..."
          },
          "final_goal_encoded": {
            "type": "string",
            "description": "The NPC's final goal, encoded..."
          }
        },
        "required": [
          "npc_name",
          "personality",
          "relational_disposition",
          "encoding_type",
          "final_goal_encoded"
        ]
      }
    },
    "emotion_state": {
      "type": "array",
      "description": "A list of current emotional states between characters.",
      "items": {
        "type": "object",
        "properties": {
          "from": {
            "type": "string",
            "description": "Name of the character or NPC expressing the emotion."
          },
          "to": {
            "type": "string",
            "description": "Name of the character or NPC who is the target..."
          },
          "stage": {
            "type": "string",
            "description": "Current emotional stage (relationship status).",
            "enum": [
              "Indifference",
              "Recognition",
              "Hostility",
              "Stability",
              "Confusion",
              "Anxiety",
              "Affection",
              "Love",
              "Possessiveness",
              "Overprotectiveness",
              "Jealousy",
              "Dependency",
              "Reverence"
            ]
          },
          "last_updated": {
            "type": "string",
            "description": "The last in-game timestamp..."
          },
          "last_trigger": {
            "type": "string",
            "description": "A short description of the most recent event..."
          }
        },
        "required": [
          "from",
          "to",
          "stage",
          "last_updated",
          "last_trigger"
        ]
      }
    },
    "emotion_log": {
      "type": "array",
      "description": "Chronological log of all significant emotional events...",
      "items": {
        "type": "object",
        "properties": {
          "log_id": {
            "type": "integer",
            "description": "A unique identifier for this log entry."
          },
          "timestamp": {
            "type": "string",
            "description": "The in-game time when this emotional event occurred."
          },
          "from": {
            "type": "string",
            "description": "Name of the character or NPC initiating the emotion or event."
          },
          "to": {
            "type": "string",
            "description": "Name of the character or NPC who is the recipient..."
          },
          "trigger": {
            "type": "string",
            "description": "The specific action or event that caused the emotion change."
          },
          "context": {
            "type": "string",
            "description": "Additional context or explanation for the emotional event."
          }
        },
        "required": [
          "log_id",
          "timestamp",
          "from",
          "to",
          "trigger",
          "context"
        ]
      }
    },
    "recent_summary": {
      "type": "string",
      "description": "A brief summary of recent session events or story progress.",
      "readOnly": true
    },
    "current_summary": {
      "type": "string",
      "description": "A brief summary of current session events or story progress.",
      "readOnly": false
    },
    "mini_quests": {
      "type": "array",
      "description": "A list of system-managed multi-stage mini quests, each encoded in base64 for secrecy.",
      "items": {
        "type": "object",
        "properties": {
          "quest_id": {
            "type": "string",
            "description": "Unique identifier for the quest (e.g., mq001)."
          },
          "title": {
            "type": "string",
            "description": "Quest title shown to the player."
          },
          "status": {
            "type": "string",
            "enum": [
              "locked",
              "ongoing",
              "completed"
            ],
            "description": "Current status of the quest."
          },
          "current_stage": {
            "type": "integer",
            "description": "The index of the current stage the player is on. Starts at 0."
          },
          "npc_involved": {
            "type": "array",
            "description": "List of NPC names directly involved in this quest.",
            "items": {
              "type": "string"
            }
          },
          "last_trigger": {
            "type": "string",
            "description": "The last in-game timestamp when the quest state was updated."
          },
          "encoded_plot_base64": {
            "type": "string",
            "description": "Base64-encoded JSON array of quest stages. After decoding, must conform to $defs.quest_stage."
          }
        },
        "required": [
          "quest_id",
          "title",
          "status",
          "encoded_plot_base64"
        ]
      }
    }
  },
  "required": [
    "time_track",
    "shared_inventory",
    "npc_goals",
    "emotion_state",
    "emotion_log",
    "recent_summary",
    "current_summary",
    "mini_quests"
  ],
  "$defs": {
    "quest_stage": {
      "type": "array",
      "description": "Decoded structure from encoded_plot_base64. Defines step-by-step structure of a multi-stage mini quest.",
      "items": {
        "type": "object",
        "properties": {
          "stage": {
            "type": "integer",
            "minimum": 1,
            "description": "Stage index, starting from 1."
          },
          "title": {
            "type": "string",
            "description": "Title of the stage."
          },
          "description": {
            "type": "string",
            "description": "Narrative for this stage."
          },
          "trigger": {
            "type": "string",
            "description": "Trigger condition or event."
          },
          "npc": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of involved NPCs for this stage."
          }
        },
        "required": [
          "stage",
          "title",
          "description",
          "trigger",
          "npc"
        ]
      }
    }
  }
}
